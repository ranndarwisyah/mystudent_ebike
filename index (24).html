<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="MyStudent E-Bike Mockup with Warnings" />
  <title>MyStudent E-Bike</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    /* Additional CSS for minor tweaks */
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    .hidden { display: none; }
    .sticky { position: sticky; top: 0; }
    .fixed { position: fixed; }
    .max-w-md { max-width: 28rem; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen pb-16 max-w-md mx-auto">
  <!-- Message Box for Notifications and Warnings -->
  <div id="message-box" class="hidden fixed top-4 left-1/2 transform -translate-x-1/2 px-4 py-3 rounded-xl shadow-lg z-50">
    <div class="flex items-center justify-between">
      <span id="message-text"></span>
      <button onclick="hideMessage()" class="ml-4 font-bold">×</button>
    </div>
  </div>

  <!-- Portal Page -->
  <div id="portal-page" class="min-h-screen pb-32">
    <div class="bg-gradient-to-r from-blue-700 to-blue-500 text-white p-4 h-40 flex flex-col justify-end">
      <div class="flex justify-between items-center mb-4">
        <h1 class="text-xl font-extrabold">MyStudent</h1>
        <div class="flex items-center space-x-2">
          <span class="text-sm">Hai <b>RANIA DARWISYAH</b></span>
          <img src="https://placehold.co/40x40/0E7490/ffffff?text=R" alt="Profile" class="w-10 h-10 rounded-full border-2 border-white" />
        </div>
      </div>
    </div>
    <div class="p-4">
      <div class="bg-white rounded-xl shadow-xl -mt-20 p-6">
        <div class="grid grid-cols-4 sm:grid-cols-5 gap-y-6 justify-items-center">
          <button class="flex flex-col items-center space-y-1 w-full max-w-[80px] p-2 hover:bg-gray-50 rounded-lg transition">
            <div class="w-12 h-12 rounded-full flex items-center justify-center bg-gray-100 border border-blue-300">
              <i data-lucide="user" class="w-6 h-6 text-blue-600"></i>
            </div>
            <span class="text-xs font-medium text-gray-700 text-center mt-1">Profil Saya</span>
          </button>
          <button class="flex flex-col items-center space-y-1 w-full max-w-[80px] p-2 hover:bg-gray-50 rounded-lg transition">
            <div class="w-12 h-12 rounded-full flex items-center justify-center bg-gray-100 border border-blue-300">
              <i data-lucide="clipboard-check" class="w-6 h-6 text-blue-600"></i>
            </div>
            <span class="text-xs font-medium text-gray-700 text-center mt-1">Keputusan Peperiksaan</span>
          </button>
          <button class="flex flex-col items-center space-y-1 w-full max-w-[80px] p-2 hover:bg-gray-50 rounded-lg transition">
            <div class="w-12 h-12 rounded-full flex items-center justify-center bg-gray-100 border border-blue-300">
              <i data-lucide="book-open" class="w-6 h-6 text-blue-600"></i>
            </div>
            <span class="text-xs font-medium text-gray-700 text-center mt-1">Kedai Buku</span>
          </button>
          <button class="flex flex-col items-center space-y-1 w-full max-w-[80px] p-2 hover:bg-gray-50 rounded-lg transition">
            <div class="w-12 h-12 rounded-full flex items-center justify-center bg-gray-100 border border-blue-300">
              <i data-lucide="graduation-cap" class="w-6 h-6 text-blue-600"></i>
            </div>
            <span class="text-xs font-medium text-gray-700 text-center mt-1">MASMED2u</span>
          </button>
          <button onclick="switchToEBike('ride')" class="flex flex-col items-center space-y-1 w-full max-w-[80px] p-2 hover:bg-gray-50 rounded-lg transition">
            <div class="w-12 h-12 rounded-full flex items-center justify-center bg-gray-100 border border-green-300">
              <i data-lucide="bike" class="w-6 h-6 text-green-600"></i>
            </div>
            <span class="text-xs font-medium text-gray-700 text-center mt-1">E-Bike Ride</span>
          </button>
          <button class="flex flex-col items-center space-y-1 w-full max-w-[80px] p-2 hover:bg-gray-50 rounded-lg transition">
            <div class="w-12 h-12 rounded-full flex items-center justify-center bg-gray-100 border border-blue-300">
              <i data-lucide="stethoscope" class="w-6 h-6 text-blue-600"></i>
            </div>
            <span class="text-xs font-medium text-gray-700 text-center mt-1">Kesihatan</span>
          </button>
          <button class="flex flex-col items-center space-y-1 w-full max-w-[80px] p-2 hover:bg-gray-50 rounded-lg transition">
            <div class="w-12 h-12 rounded-full flex items-center justify-center bg-gray-100 border border-blue-300">
              <i data-lucide="home" class="w-6 h-6 text-blue-600"></i>
            </div>
            <span class="text-xs font-medium text-gray-700 text-center mt-1">Residensi</span>
          </button>
          <div class="w-20"></div>
          <div class="w-20"></div>
        </div>
      </div>
      <div class="mt-8 space-y-4">
        <div class="p-4 rounded-xl shadow-lg flex items-center justify-between bg-blue-600 text-white hover:bg-blue-700 transition">
          <div class="flex items-center space-x-3">
            <i data-lucide="cloud" class="w-6 h-6"></i>
            <div>
              <p class="font-bold text-lg">Aduan ICT</p>
              <p class="text-sm opacity-90">Laporkan aduan ICT anda</p>
            </div>
          </div>
          <i data-lucide="arrow-right" class="w-5 h-5"></i>
        </div>
        <div class="p-4 rounded-xl shadow-lg flex items-center justify-between bg-indigo-600 text-white hover:bg-indigo-700 transition">
          <div class="flex items-center space-x-3">
            <i data-lucide="building" class="w-6 h-6"></i>
            <div>
              <p class="font-bold text-lg">Aduan Fasiliti</p>
              <p class="text-sm opacity-90">Laporkan aduan fasiliti studio</p>
            </div>
          </div>
          <i data-lucide="arrow-right" class="w-5 h-5"></i>
        </div>
      </div>
    </div>
    <div class="p-4 mt-8">
      <div class="flex items-center space-x-3 bg-white p-4 rounded-xl shadow-lg">
        <img src="https://placehold.co/40x40/FFFFFF/545454?text=UiTM" alt="UiTM Logo" class="w-10 h-10" />
        <p class="text-sm font-semibold text-gray-700">Jabatan Akademik dan Antarabangsa</p>
      </div>
    </div>
    <div class="fixed bottom-16 left-0 right-0 bg-blue-600 text-white flex justify-between items-center px-4 py-3 text-sm font-medium shadow-2xl max-w-md mx-auto z-40 rounded-t-xl">
      <span>Terdapat kemaskini terbaru.</span>
      <button class="flex items-center space-x-1 bg-white text-blue-600 px-3 py-1.5 rounded-full text-xs font-bold shadow-lg">
        <span>Kemaskini Sekarang</span>
        <i data-lucide="arrow-right" class="w-3 h-3"></i>
      </button>
    </div>
    <div class="fixed bottom-0 left-0 right-0 h-16 bg-white border-t border-gray-200 shadow-2xl flex justify-around items-center max-w-md mx-auto z-50">
      <button class="flex flex-col items-center justify-center p-2 text-gray-500">
        <div class="p-2"><i data-lucide="qr-code" class="w-6 h-6"></i></div>
        <span class="text-xs mt-1">Pengimbas QR</span>
      </button>
      <button class="flex flex-col items-center justify-center p-2 text-gray-500">
        <div class="p-2"><i data-lucide="wifi" class="w-6 h-6"></i></div>
        <span class="text-xs mt-1">Wifi@UiTM</span>
      </button>
      <div class="w-12 h-12 rounded-full bg-blue-600 text-white flex items-center justify-center -mt-4 shadow-xl border-4 border-white">
        <i data-lucide="home" class="w-6 h-6"></i>
      </div>
      <button class="flex flex-col items-center justify-center p-2 text-gray-500">
        <div class="p-2"><i data-lucide="credit-card" class="w-6 h-6"></i></div>
        <span class="text-xs mt-1">Kad Digital</span>
      </button>
      <button class="flex flex-col items-center justify-center p-2 text-gray-500">
        <div class="p-2"><i data-lucide="calendar" class="w-6 h-6"></i></div>
        <span class="text-xs mt-1">Jadual Kelas</span>
      </button>
    </div>
  </div>

  <!-- E-Bike Page -->
  <div id="ebike-page" class="hidden min-h-screen pb-16">
    <!-- E-Bike Header -->
    <div class="sticky top-0 bg-white p-4 shadow-md z-10 flex justify-between items-center border-b border-indigo-100">
      <h1 class="text-2xl font-extrabold text-indigo-600">E-Bike Campus</h1>
      <div class="flex items-center space-x-2">
        <i data-lucide="wallet" class="w-5 h-5 text-indigo-600"></i>
        <span id="uni-points" class="text-lg font-bold text-gray-800">12500 <span class="text-sm font-medium text-gray-500">pts</span></span>
      </div>
    </div>

    <!-- E-Bike Content -->
    <div id="ebike-content" class="pb-16">
      <!-- Ride Tab -->
      <div id="ride-tab" class="p-4 space-y-4">
        <div class="flex justify-between items-center p-4 bg-white shadow-sm border-b border-gray-100 sticky top-0 z-10">
          <h1 class="text-xl font-extrabold text-gray-800">E-Bike Ride</h1>
          <div class="flex items-center gap-1 p-2 bg-indigo-50 rounded-full">
            <i data-lucide="wallet" class="w-4 h-4 text-indigo-700"></i>
            <span id="ride-points" class="text-xs font-semibold text-indigo-800">12500 pts</span>
          </div>
        </div>
        <div id="ride-balance" class="bg-indigo-50 p-4 rounded-xl shadow-md border-t-4 border-indigo-500">
          <p class="text-xs font-semibold text-indigo-600 mb-1">Current Balance</p>
          <p id="balance-points" class="text-3xl font-black text-indigo-900">12500 pts</p>
          <p id="balance-rm" class="text-sm text-gray-600">≈ RM6.25</p>
        </div>
        <div id="ride-unlock" class="space-y-4">
          <h2 class="text-lg font-bold text-gray-800 flex items-center gap-2">
            <i data-lucide="lock" class="w-4 h-4"></i> Unlock Bike
          </h2>
          <div class="bg-white p-4 rounded-xl shadow-md space-y-3">
            <label class="block text-sm font-medium text-gray-700">Select Starting Location</label>
            <select id="start-location" class="mt-1 block w-full pl-3 pr-10 py-3 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg border">
              <option value="Hentian Mawar (Dc)">Hentian Mawar (Dc)</option>
              <option value="Hentian Pusat Kesihatan">Hentian Pusat Kesihatan</option>
              <option value="Hentian Anggerik">Hentian Anggerik</option>
              <option value="Hentian Perindu">Hentian Perindu</option>
              <option value="Hentian Seroja">Hentian Seroja</option>
              <option value="Hentian Fskm">Hentian Fskm</option>
              <option value="Hentian Fkpm (Mascom)">Hentian Fkpm (Mascom)</option>
            </select>
            <button id="start-ride-btn" onclick="startRide()" class="w-full flex items-center justify-center px-4 py-3 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150">
              <i data-lucide="unlock" class="w-5 h-5 mr-2"></i> Unlock E-Bike & Start Ride
            </button>
            <p id="low-balance-error" class="hidden text-red-500 text-sm mt-2">Minimum 1000 pts required to start.</p>
          </div>
        </div>
        <div id="ride-active" class="hidden space-y-4">
          <h2 class="text-lg font-bold text-gray-800 flex items-center gap-2">
            <i data-lucide="clock" class="w-4 h-4 text-indigo-500"></i> Live Charge & Status
          </h2>
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-white p-3 rounded-xl shadow-md border border-gray-100">
              <div class="flex items-center justify-between">
                <span class="text-xs font-medium text-gray-500">Time Elapsed</span>
                <i data-lucide="clock" class="w-5 h-5 text-blue-500"></i>
              </div>
              <p id="time-elapsed" class="text-xl font-bold text-gray-800 mt-1">0 min</p>
            </div>
            <div class="bg-white p-3 rounded-xl shadow-md border border-gray-100">
              <div class="flex items-center justify-between">
                <span class="text-xs font-medium text-gray-500">Cost Rate</span>
                <i data-lucide="zap" class="w-5 h-5 text-red-500"></i>
              </div>
              <p class="text-xl font-bold text-gray-800 mt-1">1000 pts / min</p>
            </div>
            <div class="bg-white p-3 rounded-xl shadow-md border border-gray-100">
              <div class="flex items-center justify-between">
                <span class="text-xs font-medium text-gray-500">Current Cost</span>
                <i data-lucide="wallet" class="w-5 h-5 text-green-500"></i>
              </div>
              <p id="current-cost" class="text-xl font-bold text-gray-800 mt-1">0 pts</p>
              <p id="current-cost-rm" class="text-xs text-gray-400">~RM0.00</p>
            </div>
            <div class="bg-white p-3 rounded-xl shadow-md border border-gray-100">
              <div class="flex items-center justify-between">
                <span class="text-xs font-medium text-gray-500">Balance Remaining</span>
                <i data-lucide="wallet" class="w-5 h-5 text-indigo-500"></i>
              </div>
              <p id="balance-remaining" class="text-xl font-bold text-gray-800 mt-1">12500 pts</p>
              <p id="balance-remaining-rm" class="text-xs text-gray-400">~RM6.25</p>
            </div>
          </div>
          <div id="drop-off-status" class="p-4 rounded-xl shadow-md border-l-4 bg-red-50 border-red-500">
            <h3 class="text-sm font-bold flex items-center gap-2 mb-2">
              <i data-lucide="map-pin" class="w-4 h-4"></i> Drop-off Status
            </h3>
            <p id="drop-off-text" class="text-sm font-semibold text-red-700">
              Nearest Zone: <b>Hentian Mawar (Dc)</b> (9999m) - Non-designated drop-off incurs <b>200 pts penalty</b>.
            </p>
          </div>
          <button id="end-ride-btn" onclick="attemptEndRide()" class="w-full flex items-center justify-center px-4 py-3 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150">
            <i data-lucide="lock" class="w-5 h-5 mr-2"></i> Attempt to End Ride & Lock Bike
          </button>
          <div id="drop-off-failed" class="hidden space-y-3">
            <div class="p-3 bg-yellow-100 border-2 border-yellow-400 text-yellow-800 rounded-lg text-sm font-semibold">
              ⚠️ Ride is still <b>ACTIVE and CHARGING</b> until bike is properly parked. Please move the bike to Hentian Mawar (Dc) to lock.
            </div>
            <button onclick="simulateCorrectParking()" class="w-full flex items-center justify-center px-4 py-3 border border-transparent text-sm font-medium rounded-lg shadow-sm text-yellow-800 bg-yellow-300 hover:bg-yellow-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500 transition duration-150">
              <i data-lucide="arrow-right" class="w-5 h-5 mr-2"></i> Simulate Moving to <b>Hentian Mawar (Dc)</b>
            </button>
          </div>
          <div class="text-xs text-center text-gray-500 mt-2">Simulated location: Lat <span id="current-lat">3.0740</span>, Lon <span id="current-lon">101.4980</span>.</div>
        </div>
      </div>

      <!-- DSS Tab -->
      <div id="dss-tab" class="hidden p-4 space-y-4">
        <div class="flex justify-between items-center p-4 bg-white shadow-sm border-b border-gray-100 sticky top-0 z-10">
          <h1 class="text-xl font-extrabold text-gray-800">DSS Path Analysis</h1>
          <div class="flex items-center gap-1 p-2 bg-indigo-50 rounded-full">
            <i data-lucide="wallet" class="w-4 h-4 text-indigo-700"></i>
            <span id="dss-points" class="text-xs font-semibold text-indigo-800">12500 pts</span>
          </div>
        </div>
        <h2 class="text-lg font-bold text-gray-800 flex items-center gap-2">
          <i data-lucide="route" class="w-4 h-4"></i> Compare Paths
        </h2>
        <div class="bg-white p-4 rounded-xl shadow-md space-y-4">
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700 flex items-center gap-1">
              <i data-lucide="locate-fixed" class="w-4 h-4 text-indigo-500"></i> Start Location
            </label>
            <select id="dss-start" onchange="updateDSS()" class="w-full pl-3 pr-10 py-3 border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg border">
              <option value="Hentian Mawar (Dc)">Hentian Mawar (Dc)</option>
              <option value="Hentian Pusat Kesihatan">Hentian Pusat Kesihatan</option>
              <option value="Hentian Anggerik">Hentian Anggerik</option>
              <option value="Hentian Perindu">Hentian Perindu</option>
              <option value="Hentian Seroja">Hentian Seroja</option>
              <option value="Hentian Fskm">Hentian Fskm</option>
              <option value="Hentian Fkpm (Mascom)">Hentian Fkpm (Mascom)</option>
            </select>
          </div>
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700 flex items-center gap-1">
              <i data-lucide="map-pin" class="w-4 h-4 text-red-500"></i> Destination
            </label>
            <select id="dss-end" onchange="updateDSS()" class="w-full pl-3 pr-10 py-3 border-gray-300 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg border">
              <option value="Hentian Pusat Kesihatan">Hentian Pusat Kesihatan</option>
              <option value="Hentian Anggerik">Hentian Anggerik</option>
              <option value="Hentian Perindu">Hentian Perindu</option>
              <option value="Hentian Seroja">Hentian Seroja</option>
              <option value="Hentian Fskm">Hentian Fskm</option>
              <option value="Hentian Fkpm (Mascom)">Hentian Fkpm (Mascom)</option>
            </select>
            <p id="dss-error" class="hidden text-red-500 text-sm mt-1">Start and End locations must be different.</p>
          </div>
        </div>
        <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
          <i data-lucide="map" class="w-4 h-4"></i> Path Visualization
        </h3>
        <div class="flex justify-center mb-4">
          <iframe src="https://geouitm.maps.arcgis.com/apps/instant/basic/index.html?appid=1802c02e5b624a388c3700a6d4dc3bfe" class="rounded-xl border-4 border-gray-200 shadow-xl w-full max-w-sm" style="height: 400px;"></iframe>
        </div>
        <button onclick="window.open('https://geouitm.maps.arcgis.com/apps/instant/basic/index.html?appid=1802c02e5b624a388c3700a6d4dc3bfe', '_blank')" class="w-full flex items-center justify-center px-4 py-3 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150">
          <i data-lucide="external-link" class="w-5 h-5 mr-2"></i> Open ArcGIS Map App
        </button>
        <p class="text-xs text-center text-gray-500">Open the full ArcGIS web app for interactive dashboard, data layers, and advanced map features.</p>
        <h3 class="text-md font-bold text-gray-800 mt-4 flex items-center gap-2">
          <i data-lucide="bar-chart-3" class="w-4 h-4"></i> System Recommendations
        </h3>
        <div id="path-analysis" class="space-y-4"></div>
        
      <div class="w-full text-left bg-white p-4 rounded-xl shadow-lg border-2 transition duration-150 border-indigo-500 ring-4 ring-indigo-200">
        <div class="flex items-center justify-between border-b pb-2 mb-2">
          <div class="flex items-center gap-3">
            <i data-lucide="leaf" class="w-6 h-6 text-indigo-500"></i>
            <h4 class="text-lg font-bold text-indigo-500">Zen Path (Low-Stress)</h4>
          </div>
          <span class="text-xs font-bold text-indigo-600 bg-indigo-100 px-3 py-1 rounded-full">Recommended</span>
        </div>
        <div class="grid grid-cols-4 text-center text-sm mt-3">
          <div>
            <p class="font-bold text-gray-800">11 min</p>
            <p class="text-xs text-gray-500">Duration</p>
          </div>
          <div>
            <p class="font-bold text-gray-800">95%</p>
            <p class="text-xs text-gray-500">Safety</p>
          </div>
          <div>
            <p class="font-bold text-gray-800">11,000 pts</p>
            <p class="text-xs text-gray-500">Cost</p>
          </div>
          <div>
            <p class="font-bold text-gray-800 text-green-600">2/10</p>
            <p class="text-xs text-gray-500">Stress Index</p>
          </div>
        </div>
        <div class="mt-3 p-3 text-xs rounded-lg border bg-indigo-50 border-indigo-200 text-indigo-700">
          Uses quiet service roads; avoids all roundabouts and high-volume intersections.
        </div>
      </div>
      
      <div class="w-full text-left bg-white p-4 rounded-xl shadow-lg border-2 transition duration-150 border-gray-200 hover:shadow-xl">
        <div class="flex items-center justify-between border-b pb-2 mb-2">
          <div class="flex items-center gap-3">
            <i data-lucide="zap" class="w-6 h-6 text-yellow-500"></i>
            <h4 class="text-lg font-bold text-yellow-500">Fastest Path</h4>
          </div>
        </div>
        <div class="grid grid-cols-4 text-center text-sm mt-3">
          <div>
            <p class="font-bold text-gray-800">8 min</p>
            <p class="text-xs text-gray-500">Duration</p>
          </div>
          <div>
            <p class="font-bold text-gray-800">82%</p>
            <p class="text-xs text-gray-500">Safety</p>
          </div>
          <div>
            <p class="font-bold text-gray-800">8,000 pts</p>
            <p class="text-xs text-gray-500">Cost</p>
          </div>
          <div>
            <p class="font-bold text-gray-800 text-red-600">8/10</p>
            <p class="text-xs text-gray-500">Stress Index</p>
          </div>
        </div>
        <div class="mt-3 p-3 text-xs rounded-lg border bg-yellow-50 border-yellow-200 text-yellow-700">
          Direct route down the main campus boulevard; expects heavy traffic and braking during peak hours.
        </div>
      </div>
      
      <div class="w-full text-left bg-white p-4 rounded-xl shadow-lg border-2 transition duration-150 border-gray-200 hover:shadow-xl">
        <div class="flex items-center justify-between border-b pb-2 mb-2">
          <div class="flex items-center gap-3">
            <i data-lucide="coins" class="w-6 h-6 text-blue-500"></i>
            <h4 class="text-lg font-bold text-blue-500">Cheapest Path</h4>
          </div>
        </div>
        <div class="grid grid-cols-4 text-center text-sm mt-3">
          <div>
            <p class="font-bold text-gray-800">8 min</p>
            <p class="text-xs text-gray-500">Duration</p>
          </div>
          <div>
            <p class="font-bold text-gray-800">82%</p>
            <p class="text-xs text-gray-500">Safety</p>
          </div>
          <div>
            <p class="font-bold text-gray-800">8,000 pts</p>
            <p class="text-xs text-gray-500">Cost</p>
          </div>
          <div>
            <p class="font-bold text-gray-800 text-red-600">8/10</p>
            <p class="text-xs text-gray-500">Stress Index</p>
          </div>
        </div>
        <div class="mt-3 p-3 text-xs rounded-lg border bg-blue-50 border-blue-200 text-blue-700">
          Identical to the Fastest route, as cost is based on ride duration.
        </div>
      </div>
        <div class="text-xs text-center text-gray-500 pt-4">Path visualizations use the ArcGIS map. Log in to interact and highlight the best choice.</div>
      </div>
      <!-- Wallet Tab -->
      <div id="wallet-tab" class="hidden p-4 space-y-4">
        <div class="flex justify-between items-center p-4 bg-white shadow-sm border-b border-gray-100 sticky top-0 z-10">
          <h1 class="text-xl font-extrabold text-gray-800">Wallet Top-up</h1>
          <div class="flex items-center gap-1 p-2 bg-indigo-50 rounded-full">
            <i data-lucide="wallet" class="w-4 h-4 text-indigo-700"></i>
            <span id="wallet-points" class="text-xs font-semibold text-indigo-800">12500 pts</span>
          </div>
        </div>
        <div class="bg-indigo-50 p-4 rounded-xl shadow-md border-t-4 border-indigo-500">
          <p class="text-xs font-semibold text-indigo-600 mb-1">Current Balance</p>
          <p id="wallet-balance-points" class="text-3xl font-black text-indigo-900">12500 pts</p>
          <p id="wallet-balance-rm" class="text-sm text-gray-600">≈ RM6.25</p>
        </div>
        <h2 class="text-lg font-bold text-gray-800">Top-up Options</h2>
        <div class="grid grid-cols-2 gap-4">
          <button onclick="topUp(10000)" class="bg-white p-4 rounded-xl shadow-lg border border-indigo-100 hover:shadow-xl transition duration-150">
            <p class="text-xl font-bold text-indigo-600">10,000 pts</p>
            <p class="text-sm text-gray-500">RM5.00</p>
          </button>
          <button onclick="topUp(20000)" class="bg-white p-4 rounded-xl shadow-lg border border-indigo-100 hover:shadow-xl transition duration-150">
            <p class="text-xl font-bold text-indigo-600">20,000 pts</p>
            <p class="text-sm text-gray-500">RM10.00</p>
          </button>
          <button onclick="topUp(50000)" class="bg-white p-4 rounded-xl shadow-lg border border-indigo-100 hover:shadow-xl transition duration-150">
            <p class="text-xl font-bold text-indigo-600">50,000 pts</p>
            <p class="text-sm text-gray-500">RM25.00</p>
          </button>
        </div>
        <div class="mt-6 p-4 bg-white rounded-xl shadow-md space-y-4">
    <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2 border-b pb-2">
        <i data-lucide="history" class="w-5 h-5 text-gray-600"></i> Transaction History
    </h3>

    <div class="space-y-3" id="transaction-history">

        <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-red-100">
            <div class="flex items-center gap-3">
                <i data-lucide="bike" class="w-5 h-5 text-red-500"></i>
                <div>
                    <p class="text-sm font-semibold text-gray-700">E-Bike Ride Cost</p>
                    <p class="text-xs text-gray-500">Oct 16, 15:45</p>
                </div>
            </div>
            <p class="text-sm font-bold text-red-500">- 8,000 pts</p>
        </div>

        <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-green-100">
            <div class="flex items-center gap-3">
                <i data-lucide="leaf" class="w-5 h-5 text-green-500"></i>
                <div>
                    <p class="text-sm font-semibold text-gray-700">Zen Path Bonus Reward</p>
                    <p class="text-xs text-gray-500">Oct 16, 15:40</p>
                </div>
            </div>
            <p class="text-sm font-bold text-green-500">+ 1,500 pts</p>
        </div>

        <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-green-100">
            <div class="flex items-center gap-3">
                <i data-lucide="wallet" class="w-5 h-5 text-green-500"></i>
                <div>
                    <p class="text-sm font-semibold text-gray-700">Account Top-up</p>
                    <p class="text-xs text-gray-500">Oct 15, 09:00</p>
                </div>
            </div>
            <p class="text-sm font-bold text-green-500">+ 20,000 pts</p>
        </div>
    </div>
</div>
      </div>

      <!-- Rewards Tab -->
      <div id="rewards-tab" class="hidden p-4 space-y-6">
        <div class="flex justify-between items-center p-4 bg-white shadow-sm border-b border-gray-100 sticky top-0 z-10">
          <h1 class="text-xl font-extrabold text-gray-800">Rewards & Penalties</h1>
          <div class="flex items-center gap-1 p-2 bg-indigo-50 rounded-full">
            <i data-lucide="wallet" class="w-4 h-4 text-indigo-700"></i>
            <span id="rewards-points" class="text-xs font-semibold text-indigo-800">12500 pts</span>
          </div>
        </div>
        <h2 class="text-xl font-bold text-gray-800">Reward System</h2>
        <div class="bg-white rounded-xl p-4 shadow-md border-l-4 border-green-500">
          <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2 text-lg">
            <i data-lucide="star" class="w-5 h-5 text-green-600"></i> Rewards & Earnings
          </h3>
          <div class="space-y-2">
            <div class="flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-lime-50 rounded-lg border border-green-200">
              <span class="text-sm text-gray-700">Recharge e-bike at a station</span>
              <div class="text-right">
                <span class="bg-green-400 text-green-900 px-3 py-1 rounded-full text-xs font-bold block">+500 pts</span>
                <span class="text-xs text-gray-500 mt-1 block">≈ RM0.25</span>
              </div>
            </div>
            <div class="flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-lime-50 rounded-lg border border-green-200">
              <span class="text-sm text-gray-700">Park in a perfect parking spot</span>
              <div class="text-right">
                <span class="bg-green-400 text-green-900 px-3 py-1 rounded-full text-xs font-bold block">+250 pts</span>
                <span class="text-xs text-gray-500 mt-1 block">≈ RM0.13</span>
              </div>
            </div>
            <div class="flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-lime-50 rounded-lg border border-green-200">
              <span class="text-sm text-gray-700">Ride completion bonus</span>
              <div class="text-right">
                <span class="bg-green-400 text-green-900 px-3 py-1 rounded-full text-xs font-bold block">+100 pts</span>
                <span class="text-xs text-gray-500 mt-1 block">≈ RM0.05</span>
              </div>
            </div>
          </div>
        </div>
        <div class="bg-white rounded-xl p-4 shadow-md border-l-4 border-red-500">
          <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2 text-lg">
            <i data-lucide="x-circle" class="w-5 h-5 text-red-600"></i> Penalties
          </h3>
          <div class="space-y-2">
            <div class="flex items-center justify-between p-3 bg-gradient-to-r from-red-50 to-orange-50 rounded-lg border border-red-200">
              <span class="text-sm text-gray-700">Non-designated parking/drop-off</span>
              <div class="text-right">
                <span class="bg-red-400 text-red-900 px-3 py-1 rounded-full text-xs font-bold block">-200 pts</span>
                <span class="text-xs text-gray-500 mt-1 block">≈ RM0.10</span>
              </div>
            </div>
            <div class="flex items-center justify-between p-3 bg-gradient-to-r from-red-50 to-orange-50 rounded-lg border border-red-200">
              <span class="text-sm text-gray-700">Leaving UiTM Geo-fence (Severe)</span>
              <div class="text-right">
                <span class="bg-red-400 text-red-900 px-3 py-1 rounded-full text-xs font-bold block">-5000 pts</span>
                <span class="text-xs text-gray-500 mt-1 block">≈ RM2.50</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- E-Bike Navigation -->
    <div class="fixed bottom-0 left-0 right-0 h-16 bg-white border-t border-gray-200 shadow-2xl flex justify-around items-center max-w-md mx-auto z-50">
      <button onclick="setActiveTab('ride')" class="flex flex-col items-center justify-center p-2 text-indigo-600">
        <i data-lucide="bike" class="w-5 h-5"></i>
        <span class="text-xs font-medium mt-1">Ride</span>
      </button>
      <button onclick="setActiveTab('dss')" class="flex flex-col items-center justify-center p-2 text-gray-500 hover:text-indigo-500">
        <i data-lucide="route" class="w-5 h-5"></i>
        <span class="text-xs font-medium mt-1">DSS</span>
      </button>
      <button onclick="setActiveTab('wallet')" class="flex flex-col items-center justify-center p-2 text-gray-500 hover:text-indigo-500">
        <i data-lucide="wallet" class="w-5 h-5"></i>
        <span class="text-xs font-medium mt-1">Wallet</span>
      </button>
      <button onclick="setActiveTab('rewards')" class="flex flex-col items-center justify-center p-2 text-gray-500 hover:text-indigo-500">
        <i data-lucide="zap" class="w-5 h-5"></i>
        <span class="text-xs font-medium mt-1">Rewards</span>
      </button>
      <button onclick="switchToPortal()" class="flex flex-col items-center justify-center p-2 text-gray-500 hover:text-indigo-500">
        <i data-lucide="arrow-left" class="w-5 h-5"></i>
        <span class="text-xs font-medium mt-1">Exit Portal</span>
      </button>
    </div>
  </div>

  
<script>
  // Initialize Lucide icons
  lucide.createIcons();

  // Configuration
  const COST_PER_MINUTE_POINTS = 1000;
  const UITM_CENTER_LAT = 3.0740;
  const UITM_CENTER_LON = 101.4980;
  const MAX_SAFE_SPEED_KMH = 15;

  const DESIGNATED_PARKING_ZONES = [
    { name: 'Hentian Mawar (Dc)', lat: 3.0725, lon: 101.5005 },
    { name: 'Hentian Pusat Kesihatan', lat: 3.0735, lon: 101.5020 },
    { name: 'Hentian Anggerik', lat: 3.0745, lon: 101.5035 },
    { name: 'Hentian Perindu', lat: 3.0755, lon: 101.5050 },
    { name: 'Hentian Seroja', lat: 3.0765, lon: 101.5065 },
    { name: 'Hentian Fskm', lat: 3.0715, lon: 101.5080 },
    { name: 'Hentian Fkpm (Mascom)', lat: 3.0705, lon: 101.5095 },
  ];

  const HAZARD_ZONES = [
    { name: 'Flood Area near Hentian Anggerik', lat: 3.0747, lon: 101.5037, radius_m: 50 },
    { name: 'Unstable Terrain near Hentian Fskm', lat: 3.0717, lon: 101.5082, radius_m: 50 },
  ];

  // State
  let appMode = 'portal';
  let activeTab = 'ride';
  let uniPoints = 12500;
  let rideActive = false;
  let elapsedSeconds = 0;
  let currentLat = UITM_CENTER_LAT;
  let currentLon = UITM_CENTER_LON;
  let currentSpeedKmh = 10;
  let lastWarningTime = 0;
  let timerInterval = null;
  let warningInterval = null;
  let messageTimeout = null;

  // Utility
  function haversine(lat1, lon1, lat2, lon2) {
    const R = 6373.0;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat / 2) ** 2 + Math.cos(lat1 * Math.PI / 180) *
              Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) ** 2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
  }

  function findNearestParkingZone(lat, lon) {
    let nearest = DESIGNATED_PARKING_ZONES[0];
    let minDist = Infinity;
    DESIGNATED_PARKING_ZONES.forEach(zone => {
      const dist = haversine(lat, lon, zone.lat, zone.lon);
      if (dist < minDist) {
        minDist = dist;
        nearest = zone;
      }
    });
    return { nearestZone: nearest, distanceMeters: minDist * 1000 };
  }

  function checkHazardZones(lat, lon) {
    for (const h of HAZARD_ZONES) {
      const dist = haversine(lat, lon, h.lat, h.lon) * 1000;
      if (dist <= h.radius_m) return h;
    }
    return null;
  }

  // Message box (simplified)
  function showMessage(text, type = 'info', duration = 3000) {
    const box = document.getElementById('message-box');
    const txt = document.getElementById('message-text');
    txt.innerText = text;
    box.className = `fixed top-4 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-lg shadow-lg z-50 text-white text-sm ${
      type === 'warning' ? 'bg-yellow-500' : type === 'danger' ? 'bg-red-500' : 'bg-indigo-500'
    }`;
    box.classList.remove('hidden');
    clearTimeout(messageTimeout);
    messageTimeout = setTimeout(() => box.classList.add('hidden'), duration);
  }

  function hideMessage() {
    document.getElementById('message-box').classList.add('hidden');
  }

  // Navigation
  function switchToEBike(tab) {
    appMode = 'ebike';
    activeTab = tab;
    document.getElementById('portal-page').classList.add('hidden');
    document.getElementById('ebike-page').classList.remove('hidden');
    setActiveTab(tab);
    showMessage('Launching E-Bike Campus App...');
  }

  function switchToPortal() {
    appMode = 'portal';
    document.getElementById('ebike-page').classList.add('hidden');
    document.getElementById('portal-page').classList.remove('hidden');
    showMessage('Exited E-Bike App. Welcome back.');
  }

  function setActiveTab(tab) {
    activeTab = tab;
    ['ride', 'dss', 'wallet', 'rewards'].forEach(t => {
      document.getElementById(`${t}-tab`).classList.toggle('hidden', t !== tab);
    });
  }

  // Ride logic
  function startRide() {
    if (uniPoints < 1000) return showMessage('❌ Not enough balance.', 'danger');
    rideActive = true;
    elapsedSeconds = 0;
    showMessage('🚴 Ride started!');

    timerInterval = setInterval(() => {
      elapsedSeconds++;
      currentSpeedKmh = 10 + Math.random() * 10;
      currentLat += (Math.random() - 0.5) * 0.0004;
      currentLon += (Math.random() - 0.5) * 0.0004;
      updateUI();
    }, 1000);

    warningInterval = setInterval(checkRideWarnings, 5000);
    updateUI();
  }

  function checkRideWarnings() {
    if (!rideActive) return;
    const now = Date.now();
    if (now - lastWarningTime < 20000) return; // only every 20s max

    const hazard = checkHazardZones(currentLat, currentLon);
    if (currentSpeedKmh > MAX_SAFE_SPEED_KMH) {
      showMessage(`⚠️ Slow down! ${currentSpeedKmh.toFixed(1)} km/h`, 'warning');
      lastWarningTime = now;
    } else if (hazard) {
      showMessage(`⚠️ Hazard nearby: ${hazard.name}`, 'danger');
      lastWarningTime = now;
    }
  }

  function attemptEndRide() {
    if (!rideActive) return;
    finalizeRide();
  }

  function finalizeRide() {
    const mins = Math.floor(elapsedSeconds / 60);
    const totalCost = mins * COST_PER_MINUTE_POINTS;
    uniPoints -= totalCost;
    rideActive = false;

    clearInterval(timerInterval);
    clearInterval(warningInterval);
    timerInterval = null;
    warningInterval = null;

    showMessage('✅ Ride ended successfully.');
    updateUI();
  }

  function simulateCorrectParking() {
    currentLat = DESIGNATED_PARKING_ZONES[0].lat;
    currentLon = DESIGNATED_PARKING_ZONES[0].lon;
    document.getElementById('drop-off-failed').classList.add('hidden');
    showMessage('✅ Moved to designated parking zone. Ride can now be ended.');
  }

  function topUp(amount) {
    uniPoints += amount;
    showMessage(`✅ Top-up successful: +${amount} pts`, 'info');
    updateUI();
  }

  function updateDSS() {
    const start = document.getElementById('dss-start').value;
    const end = document.getElementById('dss-end').value;
    const errorEl = document.getElementById('dss-error');
    if (start === end) {
      errorEl.classList.remove('hidden');
    } else {
      errorEl.classList.add('hidden');
    }
  }

  function updateUI() {
    // Update points everywhere
    ['uni-points', 'ride-points', 'dss-points', 'wallet-points', 'rewards-points', 'balance-points', 'wallet-balance-points'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.innerText = uniPoints.toLocaleString() + (id.includes('points') && !id.includes('balance') ? ' pts' : '');
    });
    ['balance-rm', 'wallet-balance-rm'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.innerText = `≈ RM${(uniPoints / 2000).toFixed(2)}`;
    });

    // Ride-specific updates
    if (rideActive) {
      const mins = Math.floor(elapsedSeconds / 60);
      const secs = elapsedSeconds % 60;
      const cost = mins * COST_PER_MINUTE_POINTS;
      document.getElementById('time-elapsed').innerText = `${mins} min ${secs} sec`;
      document.getElementById('current-cost').innerText = cost.toLocaleString() + ' pts';
      document.getElementById('current-cost-rm').innerText = `~RM${(cost / 2000).toFixed(2)}`;
      document.getElementById('balance-remaining').innerText = (uniPoints - cost).toLocaleString() + ' pts';
      document.getElementById('balance-remaining-rm').innerText = `~RM${((uniPoints - cost) / 2000).toFixed(2)}`;

      const { nearestZone, distanceMeters } = findNearestParkingZone(currentLat, currentLon);
      document.getElementById('drop-off-text').innerHTML = `Nearest Zone: <b>${nearestZone.name}</b> (${Math.round(distanceMeters)}m) - Non-designated drop-off incurs <b>200 pts penalty</b>.`;
      document.getElementById('current-lat').textContent = currentLat.toFixed(4);
      document.getElementById('current-lon').textContent = currentLon.toFixed(4);

      const dropOffFailed = document.getElementById('drop-off-failed');
      const endBtn = document.getElementById('end-ride-btn');
      if (distanceMeters <= 10) {
        dropOffFailed.classList.add('hidden');
        endBtn.classList.remove('bg-gray-400');
        endBtn.classList.add('bg-indigo-600');
        endBtn.disabled = false;
      } else {
        dropOffFailed.classList.remove('hidden');
        endBtn.classList.add('bg-gray-400');
        endBtn.classList.remove('bg-indigo-600');
        endBtn.disabled = true;
      }
    }

    // Toggle ride sections
    document.getElementById('ride-unlock').classList.toggle('hidden', rideActive);
    document.getElementById('ride-active').classList.toggle('hidden', !rideActive);
  }

  // Initial UI update
  updateUI();
</script>

</body>
</html>